<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberThreat Analyzer v10.2</title>
    <!-- ØªØ­Ù…ÙŠÙ„ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© Font Awesome Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© Vis.js Ù„Ù„Ø®Ø· Ø§Ù„Ø²Ù…Ù†ÙŠ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ -->
    <script type="text/javascript" src="https://unpkg.com/vis-timeline@latest/standalone/umd/vis-timeline-graph2d.min.js"></script>
    <link href="https://unpkg.com/vis-timeline@latest/styles/vis-timeline-graph2d.min.css" rel="stylesheet" type="text/css" />
    <style>
        /* Ø®Ø· Ù…Ø®ØµØµ Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© */
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #0d1117; /* Ø®Ù„ÙÙŠØ© Ø¯Ø§ÙƒÙ†Ø© */
            color: #c9d1d9; /* Ù†Øµ ÙØ§ØªØ­ */
            direction: rtl;
        }
        .container {
            max-width: 1200px;
        }
        .header-card {
            background-color: #161b22;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        .card {
            background-color: #161b22;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.5);
            border: 1px solid #30363d;
        }
        .critical-bg { background-color: #e53e3e; } /* Ø£Ø­Ù…Ø± ØºØ§Ù…Ù‚ */
        .high-bg { background-color: #dd6b20; } /* Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ */
        .medium-bg { background-color: #d69e2e; } /* Ø£ØµÙØ± */
        .low-bg { background-color: #38a169; } /* Ø£Ø®Ø¶Ø± */

        /* ØªØ®ØµÙŠØµ Ø²Ø± Ø§Ù„ØªØ­Ù„ÙŠÙ„ */
        .analyze-button {
            background-color: #238636; /* Ø£Ø®Ø¶Ø± ØºÙŠØª Ù‡Ø§Ø¨ */
            transition: background-color 0.3s, transform 0.1s;
        }
        .analyze-button:hover {
            background-color: #2ea043;
        }
        .analyze-button:active {
            transform: scale(0.98);
        }
        /* ØªØ®ØµÙŠØµ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª */
        .tab-button {
            transition: background-color 0.2s, color 0.2s;
            border: 1px solid transparent;
        }
        .tab-button.active {
            background-color: #30363d;
            border-color: #8b949e;
        }
        /* Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø®Ø· Ø§Ù„Ø²Ù…Ù†ÙŠ (Vis.js) */
        .vis-timeline {
            border: 1px solid #30363d !important;
            background-color: #0d1117 !important;
            color: #c9d1d9 !important;
            border-radius: 0.5rem;
        }
        .vis-item {
            background-color: #21262d !important;
            border-color: #58a6ff !important;
            color: #c9d1d9 !important;
            box-shadow: 0 0 5px rgba(88, 166, 255, 0.5);
        }
        .vis-item.vis-selected {
            border-color: #f78166 !important;
            background-color: #30363d !important;
        }
        .vis-label {
            color: #8b949e !important;
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="container mx-auto">
        
        <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <header class="text-center mb-10 header-card p-6 rounded-xl">
            <h1 class="text-4xl font-bold text-blue-400">CyberThreat Analyzer v10.2</h1>
            <p class="text-xl text-gray-400 mt-2">Ù…Ù†ØµØ© ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯Ø§Øª Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠØ© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©: Ø§Ù„Ø°ÙƒØ§Ø¡ ÙˆØ§Ù„Ø£ØªÙ…ØªØ© ÙÙŠ Ø®Ø¯Ù…ØªÙƒ</p>
        </header>

        <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„ -->
        <div class="card p-6 mb-8">
            <h2 class="text-2xl font-semibold mb-4 text-blue-300">Ù†Ù‚Ø·Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„: ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø¬Ù„ / Ø§Ù„ØªÙƒÙˆÙŠÙ†</h2>
            <form id="upload-form" class="space-y-4">
                <div class="flex flex-col sm:flex-row items-center space-y-4 sm:space-y-0 sm:space-x-4 sm:space-x-reverse">
                    <input type="file" id="file-input" name="file" class="block w-full text-sm text-gray-500
                        file:mr-4 file:py-2 file:px-4
                        file:rounded-full file:border-0
                        file:text-sm file:font-semibold
                        file:bg-indigo-50 file:text-indigo-700
                        hover:file:bg-indigo-100 cursor-pointer
                    ">
                    <button type="submit" id="analyze-btn" class="analyze-button w-full sm:w-auto px-6 py-2 text-white font-bold rounded-full flex items-center justify-center" disabled>
                        <i class="fas fa-microscope mr-2"></i>
                        <span id="btn-text">Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ‚</span>
                        <div id="loading-spinner" class="spinner ml-2 hidden">
                            <i class="fas fa-sync-alt fa-spin"></i>
                        </div>
                    </button>
                </div>
            </form>

            <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØ§Ù„Ø£Ø®Ø·Ø§Ø¡ -->
            <div id="status-message" class="mt-4 p-3 rounded-lg text-center font-medium hidden" role="alert"></div>
        </div>

        <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ (Ù…Ø®ÙÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹) -->
        <div id="analysis-results" class="space-y-8 hidden">
            
            <!-- Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø®Ø§Ø·Ø± ÙˆØ³Ø±Ø¯ÙŠØ© Ø§Ù„Ù‡Ø¬ÙˆÙ… -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                
                <!-- Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø®Ø§Ø·Ø± -->
                <div class="card p-6 lg:col-span-1">
                    <h3 class="text-xl font-bold mb-4 text-center text-red-400">Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø®Ø§Ø·Ø±</h3>
                    <div id="risk-summary" class="text-center p-6 rounded-lg">
                        <p class="text-6xl font-extrabold text-white" id="risk-score">--</p>
                        <p class="text-2xl mt-3 font-semibold text-white" id="risk-level">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</p>
                    </div>
                </div>

                <!-- Ø³Ø±Ø¯ÙŠØ© Ø§Ù„Ù‡Ø¬ÙˆÙ… -->
                <div class="card p-6 lg:col-span-2">
                    <h3 class="text-xl font-bold mb-4 text-blue-300">Ø³Ø±Ø¯ÙŠØ© Ø§Ù„Ù‡Ø¬ÙˆÙ… (AI Narrative)</h3>
                    <p id="attack-summary" class="text-gray-300 mb-4"></p>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div class="p-3 bg-[#21262d] rounded-md">
                            <p class="font-bold text-gray-400">Ø£ØµÙ„ Ø§Ù„Ù‡Ø¬ÙˆÙ… Ø§Ù„Ù…Ø±Ø¬Ø­</p>
                            <p id="attack-origin-country" class="text-white"></p>
                        </div>
                        <div class="p-3 bg-[#21262d] rounded-md">
                            <p class="font-bold text-gray-400">Ù†ÙŠØ© Ø§Ù„Ù…Ù‡Ø§Ø¬Ù…</p>
                            <p id="attacker-intent" class="text-white"></p>
                        </div>
                        <div class="col-span-2 p-3 bg-[#21262d] rounded-md">
                            <p class="font-bold text-gray-400">Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ù…ÙƒØªØ´ÙØ©</p>
                            <p id="attack-stages" class="text-white text-sm"></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„Ù†ØªØ§Ø¦Ø¬ -->
            <div class="card p-6">
                
                <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
                <div class="flex overflow-x-auto border-b border-[#30363d] mb-4">
                    <button id="tab-detailed" class="tab-button active px-4 py-2 text-sm font-medium rounded-t-lg">Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© ÙˆØ§Ù„Ù…ØµÙÙˆÙØ§Øª</button>
                    <button id="tab-ip" class="tab-button px-4 py-2 text-sm font-medium rounded-t-lg">Ø§Ø³ØªØ®Ø¨Ø§Ø±Ø§Øª IP ÙˆØ­Ø§Ù„Ø© Ø§Ù„Ø­ÙŠØ§Ø©</button>
                    <button id="tab-rca" class="tab-button px-4 py-2 text-sm font-medium rounded-t-lg">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø¬Ø°Ø±ÙŠ (RCA)</button>
                    <button id="tab-yara" class="tab-button px-4 py-2 text-sm font-medium rounded-t-lg">Ù…Ø­Ø§ÙƒØ§Ø© YARA Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©</button>
                    <button id="tab-timeline" class="tab-button px-4 py-2 text-sm font-medium rounded-t-lg">Ø§Ù„Ø®Ø· Ø§Ù„Ø²Ù…Ù†ÙŠ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ</button>
                    <button id="tab-recommendations" class="tab-button px-4 py-2 text-sm font-medium rounded-t-lg">Ø§Ù„ØªÙˆØµÙŠØ§Øª ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø¶Ø§Ø¯Ø©</button>
                </div>

                <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
                <div id="tab-content">
                    
                    <!-- Ø§Ù„ØªØ¨ÙˆÙŠØ¨ 1: Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© ÙˆØ§Ù„Ù…ØµÙÙˆÙØ§Øª (Ø§ÙØªØ±Ø§Ø¶ÙŠ) -->
                    <div id="content-detailed" class="tab-content">
                        <h4 class="text-xl font-bold mb-4 text-orange-400">Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©</h4>
                        <div id="detailed-findings-container" class="space-y-6">
                            <!-- Ø³ÙŠØªÙ… Ø­Ù‚Ù† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù€ Critical, High, Medium, Low Ù‡Ù†Ø§ -->
                        </div>
                    </div>

                    <!-- Ø§Ù„ØªØ¨ÙˆÙŠØ¨ 2: Ø§Ø³ØªØ®Ø¨Ø§Ø±Ø§Øª IP ÙˆØ­Ø§Ù„Ø© Ø§Ù„Ø­ÙŠØ§Ø© -->
                    <div id="content-ip" class="tab-content hidden">
                        <h4 class="text-xl font-bold mb-4 text-green-400">Ø§Ø³ØªØ®Ø¨Ø§Ø±Ø§Øª IP ÙˆØ­Ø§Ù„Ø© Ø§Ù„Ø­ÙŠØ§Ø©</h4>
                        <p class="text-sm text-gray-400 mb-4">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ø¹Ù†Ø§ÙˆÙŠÙ† IP Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ø³Ø¬Ù„ ÙˆØ°ÙƒØ§Ø¡ Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø±ØªØ¨Ø· Ø¨Ù‡Ø§.</p>
                        <div id="ip-intelligence-table">
                            <!-- Ø³ÙŠØªÙ… Ø­Ù‚Ù† Ø¬Ø¯ÙˆÙ„ Ø§Ø³ØªØ®Ø¨Ø§Ø±Ø§Øª IP Ù‡Ù†Ø§ -->
                        </div>
                    </div>

                    <!-- Ø§Ù„ØªØ¨ÙˆÙŠØ¨ 3: ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø¬Ø°Ø±ÙŠ (RCA) -->
                    <div id="content-rca" class="tab-content hidden">
                        <h4 class="text-xl font-bold mb-4 text-purple-400">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø¬Ø°Ø±ÙŠ (RCA)</h4>
                        <p class="text-sm text-gray-400 mb-4">ØªØ­Ù„ÙŠÙ„ Ù…ÙØµÙ„ Ù„Ù„Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„Ø¬Ø°Ø±ÙŠØ© Ù„Ù„Ø­Ø§Ø¯Ø« ÙˆØ§Ù„ØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©.</p>
                        <div id="rca-analysis-table">
                            <!-- Ø³ÙŠØªÙ… Ø­Ù‚Ù† Ø¬Ø¯ÙˆÙ„ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø¬Ø°Ø±ÙŠ Ù‡Ù†Ø§ -->
                        </div>
                    </div>

                    <!-- Ø§Ù„ØªØ¨ÙˆÙŠØ¨ 4: Ù…Ø­Ø§ÙƒØ§Ø© YARA Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© -->
                    <div id="content-yara" class="tab-content hidden">
                        <h4 class="text-xl font-bold mb-4 text-yellow-400">Ù…Ø­Ø§ÙƒØ§Ø© YARA Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©</h4>
                        <p class="text-sm text-gray-400 mb-4">Ù…Ø­Ø§ÙƒØ§Ø© Ù„Ù†ØªØ§Ø¦Ø¬ ÙØ­Øµ Ù‚ÙˆØ§Ø¹Ø¯ YARA Ø§Ù„ØªÙŠ Ù‚Ø¯ ØªÙƒÙˆÙ† Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ù…Ø¤Ø´Ø±Ø§Øª ÙÙŠ Ø§Ù„Ø³Ø¬Ù„.</p>
                        <div id="yara-analysis-table">
                            <!-- Ø³ÙŠØªÙ… Ø­Ù‚Ù† Ø¬Ø¯ÙˆÙ„ YARA Ù‡Ù†Ø§ -->
                        </div>
                    </div>

                    <!-- Ø§Ù„ØªØ¨ÙˆÙŠØ¨ 5: Ø§Ù„Ø®Ø· Ø§Ù„Ø²Ù…Ù†ÙŠ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ -->
                    <div id="content-timeline" class="tab-content hidden">
                        <h4 class="text-xl font-bold mb-4 text-cyan-400">Ø§Ù„Ø®Ø· Ø§Ù„Ø²Ù…Ù†ÙŠ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ</h4>
                        <p class="text-sm text-gray-400 mb-4">Ø¹Ø±Ø¶ Ù…Ø±Ø¦ÙŠ Ù…ØªÙØ§Ø¹Ù„ Ù„ØªØ³Ù„Ø³Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ù…Ù†ÙŠØ©.</p>
                        <div id="timeline-visualization" style="height: 300px; width: 100%;">
                            <!-- Ø³ÙŠØªÙ… ØªÙ‡ÙŠØ¦Ø© Ø®Ø· Ø§Ù„Ø²Ù…Ù† Vis.js Ù‡Ù†Ø§ -->
                        </div>
                    </div>

                    <!-- Ø§Ù„ØªØ¨ÙˆÙŠØ¨ 6: Ø§Ù„ØªÙˆØµÙŠØ§Øª ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø¶Ø§Ø¯Ø© -->
                    <div id="content-recommendations" class="tab-content hidden">
                        <h4 class="text-xl font-bold mb-4 text-pink-400">Ø§Ù„ØªÙˆØµÙŠØ§Øª ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø¶Ø§Ø¯Ø©</h4>
                        <ul id="recommendations-list" class="list-disc pr-6 space-y-2 text-gray-300">
                            <!-- Ø³ÙŠØªÙ… Ø­Ù‚Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙˆØµÙŠØ§Øª Ù‡Ù†Ø§ -->
                        </ul>
                    </div>

                </div>
            </div>

            <!-- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØµÙÙŠØ© Ù„Ù„ØªØ­Ù„ÙŠÙ„ -->
            <div class="text-center text-sm text-gray-500 mt-4">
                <p id="analysis-time-meta"></p>
            </div>
            
        </div>
    </div>

    <!-- ÙƒÙˆØ¯ JavaScript Ù„Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© ÙˆØ§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø®Ù„ÙÙŠ -->
    <script>
        const uploadForm = document.getElementById('upload-form');
        const fileInput = document.getElementById('file-input');
        const analyzeBtn = document.getElementById('analyze-btn');
        const btnText = document.getElementById('btn-text');
        const loadingSpinner = document.getElementById('loading-spinner');
        const statusMessage = document.getElementById('status-message');
        const resultsDiv = document.getElementById('analysis-results');

        // Ø¹Ù†Ø§ØµØ± Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø®Ø§Ø·Ø±
        const riskSummaryDiv = document.getElementById('risk-summary');
        const riskScoreP = document.getElementById('risk-score');
        const riskLevelP = document.getElementById('risk-level');
        
        // Ø¹Ù†Ø§ØµØ± Ø³Ø±Ø¯ÙŠØ© Ø§Ù„Ù‡Ø¬ÙˆÙ…
        const attackSummaryP = document.getElementById('attack-summary');
        const attackOriginCountryP = document.getElementById('attack-origin-country');
        const attackerIntentP = document.getElementById('attacker-intent');
        const attackStagesP = document.getElementById('attack-stages');

        // Ø­Ø§ÙˆÙŠØ§Øª Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
        const detailedFindingsContainer = document.getElementById('detailed-findings-container');
        const ipIntelligenceTableDiv = document.getElementById('ip-intelligence-table');
        const rcaAnalysisTableDiv = document.getElementById('rca-analysis-table');
        const yaraAnalysisTableDiv = document.getElementById('yara-analysis-table');
        const recommendationsList = document.getElementById('recommendations-list');
        const analysisTimeMetaP = document.getElementById('analysis-time-meta');

        // Ø§Ù„Ø®Ø· Ø§Ù„Ø²Ù…Ù†ÙŠ
        const timelineVisualizationDiv = document.getElementById('timeline-visualization');
        let timeline = null; // Ù„Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ù†Ø³Ø®Ø© Ù…Ù† Ø®Ø· Ø§Ù„Ø²Ù…Ù†

        // ------------------------------------------
        // ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¹Ø§Ù…Ø©
        // ------------------------------------------

        /**
         * ÙŠØ¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø­Ø§Ù„Ø© (Ø®Ø·Ø£ Ø£Ùˆ Ù†Ø¬Ø§Ø­) Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©.
         * @param {string} message - Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©.
         * @param {string} type - Ù†ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ('success' Ø£Ùˆ 'error' Ø£Ùˆ 'info').
         */
        function displayStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.classList.remove('hidden', 'bg-red-800', 'bg-green-800', 'bg-blue-800', 'text-white');
            
            if (type === 'error') {
                statusMessage.classList.add('bg-red-800', 'text-white');
            } else if (type === 'success') {
                statusMessage.classList.add('bg-green-800', 'text-white');
            } else {
                statusMessage.classList.add('bg-blue-800', 'text-white');
            }
        }

        /**
         * ÙŠÙ‚ÙˆÙ… Ø¨ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø²Ø± Ø§Ù„ØªØ­Ù„ÙŠÙ„ (ØªÙ…ÙƒÙŠÙ†/ØªØ¹Ø·ÙŠÙ„ + ØªØ­Ù…ÙŠÙ„).
         * @param {boolean} isLoading - Ù‡Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„.
         */
        function updateButtonState(isLoading) {
            if (isLoading) {
                analyzeBtn.disabled = true;
                loadingSpinner.classList.remove('hidden');
                btnText.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...';
            } else {
                analyzeBtn.disabled = fileInput.files.length === 0;
                loadingSpinner.classList.add('hidden');
                btnText.textContent = 'Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ‚';
            }
        }

        // ------------------------------------------
        // ÙˆØ¸Ø§Ø¦Ù Ø¨Ù†Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        // ------------------------------------------

        /**
         * ÙŠÙ‚ÙˆÙ… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø­Ø§Ù„Ø© (Ø­ÙŠ Ø£Ùˆ Ù…ÙŠØª) Ù„Ø¬Ø¯ÙˆÙ„ IP.
         * @param {string} status - Ø­Ø§Ù„Ø© IP ('Ø­ÙŠ', 'Ù…ÙŠØª', 'N/A').
         * @returns {string} - ÙƒÙˆØ¯ HTML Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©.
         */
        function renderStatusIcon(status) {
            const normalizedStatus = status.toLowerCase().trim();
            if (normalizedStatus === 'Ø­ÙŠ') {
                return '<i class="fas fa-circle text-green-500 text-xs ml-1"></i> Ø­ÙŠ';
            } else if (normalizedStatus === 'Ù…ÙŠØª') {
                return '<i class="fas fa-circle text-red-500 text-xs ml-1"></i> Ù…ÙŠØª';
            }
            return status; // Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ù†Øµ ÙƒÙ…Ø§ Ù‡Ùˆ Ù„Ù€ N/A Ø£Ùˆ Ø£ÙŠ Ø­Ø§Ù„Ø© Ø£Ø®Ø±Ù‰
        }


        /**
         * Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ HTML Ù…Ù† Ù…ØµÙÙˆÙØ© Ø¨ÙŠØ§Ù†Ø§Øª.
         * @param {Array<Object>} data - Ù…ØµÙÙˆÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.
         * @param {Array<string>} headers - Ø±Ø¤ÙˆØ³ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨.
         * @returns {string} - ÙƒÙˆØ¯ HTML Ù„Ù„Ø¬Ø¯ÙˆÙ„.
         */
        function createTableHTML(data, headers, isIpTable = false) {
            if (!data || data.length === 0) {
                return '<p class="text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„.</p>';
            }

            let html = '<div class="overflow-x-auto"><table class="min-w-full divide-y divide-[#30363d] rounded-lg">';
            
            // Ø±Ø¤ÙˆØ³ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            html += '<thead class="bg-[#21262d]">';
            html += '<tr>';
            headers.forEach(header => {
                html += `<th class="px-4 py-3 text-right text-xs font-medium text-gray-400 uppercase tracking-wider">${header}</th>`;
            });
            html += '</tr>';
            html += '</thead>';

            // Ø¬Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„
            html += '<tbody class="divide-y divide-[#30363d]">';
            data.forEach((row, index) => {
                const bgColor = index % 2 === 0 ? 'bg-[#161b22]' : 'bg-[#1e2329]'; // ØªØ¸Ù„ÙŠÙ„ Ù…ØªÙ†Ø§ÙˆØ¨
                html += `<tr class="${bgColor}">`;
                headers.forEach(headerKey => {
                    let cellContent = row[headerKey] || '';
                    
                    // ğŸ›‘ğŸ›‘ğŸ›‘ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ù„ÙˆÙ†Ø© Ù„Ø­Ø§Ù„Ø© IP ğŸ›‘ğŸ›‘ğŸ›‘
                    if (isIpTable && headerKey === 'Ø§Ù„Ø­Ø§Ù„Ø©') {
                        cellContent = renderStatusIcon(cellContent);
                    }

                    html += `<td class="px-4 py-4 whitespace-normal text-sm text-gray-300">${cellContent}</td>`;
                });
                html += '</tr>';
            });
            html += '</tbody>';
            html += '</table></div>';
            return html;
        }

        /**
         * Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø³Ù… Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© (Critical, High, Medium, Low).
         * @param {Object} detailedFindings - Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ÙØµÙ„Ø©.
         */
        function renderDetailedFindings(detailedFindings) {
            detailedFindingsContainer.innerHTML = ''; // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ø§ÙˆÙŠØ©
            
            const severityOrder = ['critical', 'high', 'medium', 'low'];
            const severityMap = {
                critical: { title: 'Ù†ØªØ§Ø¦Ø¬ Ø­Ø±Ø¬Ø© (Critical)', color: 'critical-bg', icon: 'fas fa-skull-crossbones' },
                high: { title: 'Ù†ØªØ§Ø¦Ø¬ Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø®Ø·ÙˆØ±Ø© (High)', color: 'high-bg', icon: 'fas fa-exclamation-triangle' },
                medium: { title: 'Ù†ØªØ§Ø¦Ø¬ Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ø®Ø·ÙˆØ±Ø© (Medium)', color: 'medium-bg', icon: 'fas fa-bell' },
                low: { title: 'Ù†ØªØ§Ø¦Ø¬ Ù…Ù†Ø®ÙØ¶Ø© Ø§Ù„Ø®Ø·ÙˆØ±Ø© (Low)', color: 'low-bg', icon: 'fas fa-info-circle' }
            };

            severityOrder.forEach(key => {
                const findings = detailedFindings[key];
                if (findings && Array.isArray(findings) && findings.length > 0) {
                    const meta = severityMap[key];
                    let html = `
                        <div class="border-2 rounded-lg p-4" style="border-color: ${meta.color.split('-')[0] === 'critical' ? '#e53e3e' : meta.color.split('-')[0] === 'high' ? '#dd6b20' : meta.color.split('-')[0] === 'medium' ? '#d69e2e' : '#38a169'}">
                            <h5 class="text-lg font-bold mb-3 flex items-center ${meta.color.split('-')[0] === 'critical' ? 'text-red-400' : meta.color.split('-')[0] === 'high' ? 'text-orange-400' : meta.color.split('-')[0] === 'medium' ? 'text-yellow-400' : 'text-green-400'}">
                                <i class="${meta.icon} ml-2"></i> ${meta.title} (${findings.length})
                            </h5>
                            <div class="space-y-4">
                    `;
                    findings.forEach(finding => {
                        html += `
                            <div class="p-3 bg-[#21262d] rounded-md border-r-4" style="border-color: ${meta.color.split('-')[0] === 'critical' ? '#e53e3e' : meta.color.split('-')[0] === 'high' ? '#dd6b20' : meta.color.split('-')[0] === 'medium' ? '#d69e2e' : '#38a169'}">
                                <p class="font-semibold text-white mb-1"><i class="fas fa-bug ml-1 text-sm"></i> Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${finding["Ø§Ù„Ù†ØªÙŠØ¬Ø©"]}</p>
                                <p class="text-gray-400 text-sm"><i class="fas fa-shield-alt ml-1 text-sm"></i> Ø§Ù„ØªÙˆØµÙŠØ©: ${finding["Ø§Ù„ØªÙˆØµÙŠØ©"]}</p>
                            </div>
                        `;
                    });
                    html += `
                            </div>
                        </div>
                    `;
                    detailedFindingsContainer.innerHTML += html;
                }
            });

            if (detailedFindingsContainer.innerHTML === '') {
                detailedFindingsContainer.innerHTML = '<p class="text-gray-500">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ ØªÙØµÙŠÙ„ÙŠØ© ØªØªØ·Ù„Ø¨ ØªØµÙ†ÙŠÙ Ø®Ø·ÙˆØ±Ø©.</p>';
            }
        }
        
        /**
         * ØªÙ‡ÙŠØ¦Ø© ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø®Ø· Ø§Ù„Ø²Ù…Ù†ÙŠ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ.
         * @param {Object} timelineData - Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø· Ø§Ù„Ø²Ù…Ù†ÙŠ.
         */
        function renderTimeline(timelineData) {
            // ØªÙ†Ø¸ÙŠÙ Ø£ÙŠ Ø®Ø· Ø²Ù…Ù†ÙŠ Ø³Ø§Ø¨Ù‚
            if (timeline) {
                timeline.destroy();
            }

            if (!timelineData || !Array.isArray(timelineData.items) || timelineData.items.length === 0) {
                timelineVisualizationDiv.innerHTML = '<p class="text-gray-500 p-4">Ù„Ø§ ØªØªÙˆÙØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø· Ø²Ù…Ù†ÙŠ ØªÙØ§Ø¹Ù„ÙŠ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªØ­Ù„ÙŠÙ„.</p>';
                return;
            }

            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªÙ†Ø§Ø³Ø¨ Vis.js
            const items = new vis.DataSet(timelineData.items.map(item => ({
                id: item.id,
                content: item.content,
                start: item.start,
                group: item.group,
                type: item.type || 'point', // Ø§ÙØªØ±Ø§Ø¶ÙŠ
                style: item.style || 'background-color: #58a6ff; border-color: #58a6ff;'
            })));

            const groups = new vis.DataSet(timelineData.groups.map(group => ({
                id: group.id,
                content: group.content
            })));

            const options = {
                template: function (item) {
                    return `<div class="p-1">${item.content}</div>`;
                },
                orientation: 'top',
                autoResize: true,
                editable: false,
                stack: true,
                zoomMax: 315360000000, // 10 years in ms
                zoomMin: 1000, // 1 second in ms
                // ØªØ®ØµÙŠØµ Ø§Ù„Ø£Ø³Ù„ÙˆØ¨ Ù„ÙŠØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¯Ø§ÙƒÙ†Ø©
                locale: 'ar',
                multiselect: true,
                clickToUse: true,
                start: items.min('start') ? new Date(items.min('start').start).getTime() - 86400000 : new Date().getTime() - 86400000,
                end: items.max('start') ? new Date(items.max('start').start).getTime() + 86400000 : new Date().getTime() + 86400000,
            };

            timeline = new vis.Timeline(timelineVisualizationDiv, items, groups, options);
            
            // Ø¬Ø¹Ù„ Ø®Ø· Ø§Ù„Ø²Ù…Ù† ÙŠØ³ØªØ¬ÙŠØ¨ Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø­Ø¬Ù… Ø§Ù„Ø´Ø§Ø´Ø©
            if (window.timelineResizeListener) {
                window.removeEventListener('resize', window.timelineResizeListener);
            }
            window.timelineResizeListener = () => {
                if (timeline) timeline.fit();
            };
            window.addEventListener('resize', window.timelineResizeListener);
        }

        // ------------------------------------------
        // ÙˆØ¸ÙŠÙØ© Ù…Ø¹Ø§Ù„Ø¬Ø© Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„
        // ------------------------------------------

        /**
         * ÙŠÙ‚ÙˆÙ… Ø¨Ø­Ù‚Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ­Ù„ÙŠÙ„ ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©.
         * @param {Object} data - ÙƒØ§Ø¦Ù† JSON Ù…Ù† Ø§Ø³ØªØ¬Ø§Ø¨Ø© API.
         */
        function displayAnalysis(data) {
            resultsDiv.classList.remove('hidden');

            // 1. Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø®Ø§Ø·Ø±
            const risk = data.risk_assessment;
            riskScoreP.textContent = risk.score || 'N/A';
            riskLevelP.textContent = risk.level || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            
            riskSummaryDiv.className = 'text-center p-6 rounded-lg'; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
            const colorClass = risk.color_class ? risk.color_class.toLowerCase() : 'low';
            riskSummaryDiv.classList.add(`${colorClass}-bg`);

            // 2. Ø³Ø±Ø¯ÙŠØ© Ø§Ù„Ù‡Ø¬ÙˆÙ…
            const narrative = data.attack_narrative;
            attackSummaryP.textContent = narrative.summary || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø±Ø¯ÙŠØ© Ù…ØªØ§Ø­Ø©.';
            attackOriginCountryP.textContent = narrative.attack_origin_country || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            attackerIntentP.textContent = narrative.attacker_intent || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            attackStagesP.textContent = (narrative.stages_found && narrative.stages_found.length > 0) ? narrative.stages_found.join(' ğŸ›¡ï¸ ') : 'Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…Ø±Ø§Ø­Ù„ Ù‡Ø¬ÙˆÙ… ÙˆØ§Ø¶Ø­Ø©.';
            
            // 3. Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ (Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø°ÙŠ Ø·Ù„Ø¨ØªÙ‡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙÙŠÙ‡)
            const tables = data.tables;
            
            // 3.1. Ø§Ø³ØªØ®Ø¨Ø§Ø±Ø§Øª IP (Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù…Ø¹ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ù…Ù„ÙˆÙ†Ø©)
            if (tables.ip_intelligence) {
                const ipHeaders = ["Ø¹Ù†ÙˆØ§Ù† IP", "Ø§Ù„Ù…Ù†Ø¸Ù…Ø©", "Ø§Ù„Ø¯ÙˆÙ„Ø©", "Ø§Ù„Ø¯ÙˆØ±", "Ø§Ù„Ø­Ø§Ù„Ø©"];
                ipIntelligenceTableDiv.innerHTML = createTableHTML(tables.ip_intelligence, ipHeaders, true); // ğŸ›‘ğŸ›‘ğŸ›‘ true Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ğŸ›‘ğŸ›‘ğŸ›‘
            }

            // 3.2. ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø¬Ø°Ø±ÙŠ (RCA)
            if (tables.rca_analysis) {
                const rcaHeaders = ["Ø¹Ù†ØµØ± Ø§Ù„ØªØ­Ù„ÙŠÙ„", "Ø§Ù„Ù†ØªÙŠØ¬Ø©/Ø§Ù„ØªÙØ§ØµÙŠÙ„", "Ø§Ù„ØªÙˆØµÙŠØ©"];
                rcaAnalysisTableDiv.innerHTML = createTableHTML(tables.rca_analysis, rcaHeaders);
            }

            // 3.3. Ù…Ø­Ø§ÙƒØ§Ø© YARA
            if (tables.yara_analysis) {
                const yaraHeaders = ["Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©", "Ø§Ù„Ø´Ø¯Ø©", "Ø§Ù„Ù†ØªÙŠØ¬Ø©"];
                yaraAnalysisTableDiv.innerHTML = createTableHTML(tables.yara_analysis, yaraHeaders);
            }
            
            // 4. Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©
            if (data.detailed_findings) {
                renderDetailedFindings(data.detailed_findings);
            }

            // 5. Ø§Ù„ØªÙˆØµÙŠØ§Øª
            recommendationsList.innerHTML = '';
            if (data.recommendations && data.recommendations.length > 0) {
                data.recommendations.forEach(rec => {
                    const li = document.createElement('li');
                    li.textContent = rec;
                    recommendationsList.appendChild(li);
                });
            } else {
                recommendationsList.innerHTML = '<p class="text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙˆØµÙŠØ§Øª Ù…Ø­Ø¯Ø¯Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªØ­Ù„ÙŠÙ„.</p>';
            }

            // 6. Ø§Ù„Ø®Ø· Ø§Ù„Ø²Ù…Ù†ÙŠ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ
            if (data.interactive_timeline) {
                renderTimeline(data.interactive_timeline);
            }

            // 7. Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØµÙÙŠØ©
            analysisTimeMetaP.textContent = `ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø§Ù„ØªØ­Ù„ÙŠÙ„ ÙÙŠ: ${data.analysis_metadata.analysis_time || 'ÙˆÙ‚Øª ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}`;
        }
        
        // ------------------------------------------
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        // ------------------------------------------

        // ØªÙ…ÙƒÙŠÙ† Ø²Ø± Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù
        fileInput.addEventListener('change', () => {
            analyzeBtn.disabled = fileInput.files.length === 0;
            if (fileInput.files.length > 0) {
                statusMessage.classList.add('hidden');
            }
        });

        // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ (Ø§Ù„ØªØ­Ù„ÙŠÙ„)
        uploadForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const file = fileInput.files[0];
            if (!file) {
                displayStatus('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø³Ø¬Ù„ Ù„Ù„ØªØ­Ù„ÙŠÙ„.', 'info');
                return;
            }

            updateButtonState(true);
            resultsDiv.classList.add('hidden'); // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
            statusMessage.classList.add('hidden');

            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    body: formData,
                });

                const data = await response.json();

                if (response.ok) {
                    if (data.success === false) {
                         // Ø®Ø·Ø£ Ù…Ù† API Ù„ÙƒÙ† Ø¬Ø§Ø¡ ÙÙŠ Ø§Ø³ØªØ¬Ø§Ø¨Ø© 200 (Ù†Ø§Ø¯Ø±) Ø£Ùˆ Ø®Ø·Ø£ Ù…Ù†Ø·Ù‚ÙŠ Ø¢Ø®Ø±
                        displayStatus(data.error || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ ÙÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©.', 'error');
                    } else {
                        // Ù†Ø¬Ø§Ø­ Ø§Ù„ØªØ­Ù„ÙŠÙ„
                        displayStatus('âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø£Ø¯Ù†Ø§Ù‡.', 'success');
                        displayAnalysis(data);
                        // Ø¨Ø¹Ø¯ Ø§Ù„Ù†Ø¬Ø§Ø­ØŒ Ù†Ù†ØªÙ‚Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ù„Ù‰ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©
                        document.getElementById('tab-detailed').click(); 
                    }
                } else {
                    // Ø®Ø·Ø£ Ù…Ù† Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø®Ø§Ø¯Ù… (4xx Ø£Ùˆ 5xx)
                    displayStatus(`ğŸš« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù… (${response.status}): ${data.error || 'ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ù„ÙÙŠØ©.'}`, 'error');
                }

            } catch (error) {
                console.error('Fetch Error:', error);
                displayStatus('âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø®Ù„ÙÙŠØ© ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.', 'error');
            } finally {
                updateButtonState(false);
            }
        });

        // ------------------------------------------
        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª (Tabs)
        // ------------------------------------------

        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetId = button.id.replace('tab-', 'content-');

                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙ†Ø´ÙŠØ· Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª
                tabButtons.forEach(btn => btn.classList.remove('active', 'bg-[#30363d]', 'border-[#8b949e]'));
                tabContents.forEach(content => content.classList.add('hidden'));

                // ØªÙ†Ø´ÙŠØ· Ø§Ù„Ø²Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„
                button.classList.add('active', 'bg-[#30363d]', 'border-[#8b949e]');
                document.getElementById(targetId).classList.remove('hidden');

                // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø­ØªÙˆØ§Ø¡ Ø§Ù„Ø®Ø· Ø§Ù„Ø²Ù…Ù†ÙŠ Ø¥Ø°Ø§ ØªÙ… Ø§Ø®ØªÙŠØ§Ø±Ù‡
                if (targetId === 'content-timeline' && timeline) {
                    // ØªØ£Ø®ÙŠØ± ØµØºÙŠØ± Ù„Ø¶Ù…Ø§Ù† Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø±Ù†Ø¯Ø±
                    setTimeout(() => timeline.fit(), 100); 
                }
            });
        });

        // ØªÙ…ÙƒÙŠÙ† Ø²Ø± Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ù„Ù Ù…Ø­Ø¯Ø¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹ (Ù„Ù„ØªØ¬Ø±Ø¨Ø©)
        window.addEventListener('load', () => {
             analyzeBtn.disabled = fileInput.files.length === 0;
        });

    </script>
</body>
</html>
